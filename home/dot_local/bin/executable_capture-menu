#!/bin/bash

SCREENSHOT_DIR="$HOME/pictures/captures"

mkdir -p "$SCREENSHOT_DIR" "$VIDEO_DIR"

# Target menu
target=$(echo -e "Selection\nWindow\nFull Screen" | rofi -dmenu -p "Capture target")
[[ -z "$target" ]] && exit 0

sleep 0.15

timestamp=$(date +%Y%m%d-%H%M%S)
OUTFILE="$SCREENSHOT_DIR/$timestamp.png"

get_geometry() {
    case "$target" in
        "Selection")
            slop -f "%x %y %w %h" || exit 1
            ;;
        "Window")
            eval "$(xdotool getactivewindow getwindowgeometry --shell)"
            echo "$X $Y $WIDTH $HEIGHT"
            ;;
        "Full Screen")
            read -r sw sh < <(xdpyinfo | awk '/dimensions:/ {split($2,a,"x"); print a[1], a[2]}')
            echo "0 0 $sw $sh"
            ;;
    esac
}

case "$target" in
    "Selection")    maim -s "$OUTFILE" ;;
    "Window")       maim -i "$(xdotool getactivewindow)" "$OUTFILE" ;;
    "Full Screen")  maim "$OUTFILE" ;;
esac

if [[ -f "$OUTFILE" ]]; then
    xclip -selection clipboard -t image/png < "$OUTFILE"
    notify-send "Screenshot saved" "$OUTFILE"
fi
