#!/bin/bash
OAUTH_TOKEN=$(cat ~/.config/github-copilot/apps.json | jq -r .[].oauth_token)
API_TOKEN=$(curl -sL https://api.github.com/copilot_internal/v2/token -H "Authorization: Bearer $OAUTH_TOKEN" -H "Content-Type: application/json" -H "Copilot-Integration-Id: vscode-chat" | jq -r ".token")
if [[ "$(uname -o)" == "Darwin" ]]; then
  URL=https://api.business.githubcopilot.com
else
  URL=https://api.githubcopilot.com
fi

curl -sL -H "Accept: application/json" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Copilot-Integration-Id: vscode-chat" \
  -H "Editor-Version: curl/0.1.0" \
  "$URL" | jq -r '.data[].id'
