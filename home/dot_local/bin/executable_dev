#!/bin/bash
set -euo pipefail

# Configuration
readonly DATA="$HOME/.local/share/devcontainer"
readonly CONTAINER="ghcr.io/burnskp/containers/dev:latest"

if ! docker image inspect "$CONTAINER" 2> /dev/null; then
  echo "Image not found locally. Pulling $CONTAINER..."
  docker pull "$CONTAINER"
else
  docker pull "$CONTAINER" || true
fi

if git -C "$(dirname "$(realpath "$PWD")")" rev-parse 2> /dev/null; then
  root="$(git -C "$(dirname "$(realpath "$PWD")")" rev-parse --show-toplevel)"
else
  root="$PWD"
  container_dir="$(basename "$root")"
fi
container_dir="$(basename "$root")"
docker run --rm -it \
  -v "$DATA:/data" \
  -v "$root:/$container_dir" \
  --entrypoint "zsh" \
  "$CONTAINER"
