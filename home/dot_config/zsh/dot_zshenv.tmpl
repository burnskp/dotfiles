#!/bin/zsh
umask 022

export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_STATE_HOME="$HOME/.local/state"
export XDG_CACHE_HOME="$HOME/.cache"

if ! [ -d "$XDG_STATE_HOME/zsh" ]; then
  mkdir -p $XDG_STATE_HOME/zsh
fi

{{ if eq .chezmoi.os "darwin" -}}
export HOMEBREW_BUNDLE_DUMP_NO_VSCODE=true

if [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

if [[ -S "$HOME/Library/Containers/com.maxgoedjen.Secretive.SecretAgent/Data/socket.ssh" ]]; then
  export SSH_AUTH_SOCK="$HOME/Library/Containers/com.maxgoedjen.Secretive.SecretAgent/Data/socket.ssh"
fi
{{ else -}}
if [[ -S $XDG_RUNTIME_DIR/gcr/ssh ]]; then
  export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/gcr/ssh"
fi
{{ end -}}

set -o noclobber
setopt nobeep
setopt correct
setopt extended_glob
setopt hash_list_all
setopt interactivecomments
setopt noflowcontrol
setopt nonomatch
setopt noshwordsplit
setopt prompt_subst

export BAT_THEME="Catppuccin Latte"
export GLAMOUR_STYLE="$HOME/.config/glamour/catppuccin-latte.json"
export EDITOR="nvim"
export SUDO_EDITOR="nvim"
export HISTFILE="$XDG_STATE_HOME/zsh/history"
export TERMINAL=ghostty
export HISTSIZE=25000
export LESS=-R
export PAGER="less -R"
export SAVEHIST=25000

setopt APPEND_HISTORY
setopt EXTENDED_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_NO_STORE
setopt HIST_REDUCE_BLANKS
setopt HIST_SAVE_NO_DUPS
setopt HIST_VERIFY
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY

export ANSIBLE_HOME="$XDG_DATA_HOME/ansible"
export CARGO_HOME="$XDG_DATA_HOME/cargo"
export CLAUDE_CONFIG_DIR="$XDG_CONFIG_HOME/claude"
export CODEX_HOME="$XDG_DATA_HOME/codex"
export DOCKER_CONFIG="$XDG_CONFIG_HOME/docker"
export GEM_HOME="$XDG_DATA_HOME/gem"
export GEM_SPEC_CACHE="$XDG_CACHE_HOME/gem"
export GNUPGHOME="$XDG_DATA_HOME/gnupg"
export GTK2_RC_FILES="$XDG_CONFIG_HOME/gtk-2.0/gtkrc"
export KREW_ROOT="$XDG_DATA_HOME/krew"
export LESSHISTFILE="$XDG_STATE_HOME/less/history"
export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME/npm/npmrc"
export PYTHON_HISTORY="$XDG_DATA_HOME/python/history"
export RBENV_ROOT="$XDG_DATA_HOME/rbenv"
export RUSTUP_HOME="$XDG_DATA_HOME/rustup"
export TALOSCONFIG="$XDG_CONFIG_HOME/talos/config"
export TERMINFO="$XDG_DATA_HOME/terminfo"
export TERMINFO_DIRS="$XDG_DATA_HOME/terminfo:/usr/share/terminfo"
export W3M_DIR="$XDG_DATA_HOME/w3m"
export BUN_INSTALL="$HOME/.local/share/bun"
export GOPATH=$HOME/.local/share/go
export GOBIN=$GOPATH/bin

check_paths=("${GOBIN}")
check_paths+="${BUN_INSTALL}/bin"
check_paths+="${CARGO_HOME}/bin"
check_paths+="${HOME}/.local/bin"
check_paths+="${HOME}/.local/share/node/bin"
check_paths+="${HOME}/.yarn/bin"
check_paths+="${HOME}/bin"
check_paths+="${KREW_ROOT}/bin"
check_paths+="${XDG_DATA_HOME}/npm/bin"

for p in $check_paths; do
  if [[ -d "$p" ]]; then
    path+="$p"
  fi
done

if [[ -n $GHOSTTY_RESOURCES_DIR ]]; then
  source "$GHOSTTY_RESOURCES_DIR"/shell-integration/zsh/ghostty-integration
fi

typeset -U PATH
export PATH
